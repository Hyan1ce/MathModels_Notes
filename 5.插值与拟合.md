# 5.插值与拟合

---

## 插值

**基本概念**：观测点/插值节点；被插函数/原函数；插值函数；插值条件；最小区间/插值区间；插值点；插值

插值方法一般用于插值区间**内部**点的函数值预测或估计



## 插值方法

### 1.**待定系数法**

利用n+1个点构造n+1个约束函数，可以联立方程组求出n次多项式的m+1个系数

可以证明，当$x_i$各不相同时，有且仅有一组解，即仅有一个满足条件的多项式

**缺点**：插值节点逐渐增多时，多项式次数会增大；每增加一个节点都需要重新计算插值多项式

**Code**：

```matlab
clc,clear
x0=[1:6]';y0=[16,18,21,17,15,12]';
A=vander(x0),p=A\y0; % p:多项式系数矩阵  vander:Vandermonde矩阵
x=[1.5,2.6];
yh=polyval(p,x)
```

> vander：将v向量转化为范德蒙德行列式
>
> \：$Ax=B,x=A$ \ $B$
>
> polyval：polyval(p,x)，计算多项式 p 在 x 的每个点处的值



### 2.**拉格朗日插值法**

求解结果同一，可证明

先构造一组基函数：
$$
l_i(x_j)=\sum_{i=0}^ny_il_i(x)=\sum_{i=0}^n(\prod_{j=0,j\neq i}\frac{x-x_j}{x_i-x_j})
$$
从而满足：
$$
l_i(x_i)=0,j\neq i\\
l_i(x_i)=1,j= i
$$
matlab中无函数，需自己定义（教材里有）（不如Python）



### 3.牛顿插值法

**差商**：也称均差，即$f(x)$上两点连线的斜率：$f[x_i,x_j]=\frac{f(x_i)-f(x_j)}{x_i-x_j}$，称为一阶差商

**二阶差商**：一阶差商的差商成为二阶差商，记为$f[x_i,x_j,x_k]$，可推广到n阶差商



#### 牛顿插值公式



#### Runge震荡现象

插值次数越高，插值结果越偏离原函数



### 4.分段线性插值

将每两个相邻的节点用直线连起来，形成的直线就是分段线性插值函数，记为$I_n(x)$
$$
I_n(x)=\sum_{i=0}^ny_il_i(x)
$$
其具有良好的**收敛性**，即对于$x\in [a,b]$，有
$$
\lim_{n\rightarrow+\infty}I_n(x)=f(x)
$$
即区间内的点个数趋于无穷时，插值函数与$f(x)$相等



### 5.三次样条插值

插值函数曲线平滑

**要求**：

1. $S(x)$在每个子区间上是一个三次多项式
2. 在每个节点处有$S(x_i)=y_i=f(x_i)$
3. 满足$y_i$处左右样条函数的**值、一阶导数、二阶导数**均相等

以上给出了4n-2个条件，想要求出所有参数仍缺少两个条件，故补充边界条件：

1. **自由边界条件**

   边界点处的二阶导数值与$f(x)$的二阶导数值相等，即$S''(x_0)=f''(x_0)，S''(x_n)=f''(x_n)$

   特别地，当$S''(x_0)=S''(x_n)=0$时称之为自然样条

2. **固定边界条件**

   边界点与$f(x)$的一阶导数值相等

3. **周期边界条件**

   当$f(x)$为周期函数时，$S(x)$亦然，故端点满足：一阶、二阶导数值相等



### 6.二维插值

> 真的能用上么

1. 最邻近点插值

   区插值点的函数值为其最临近插值节点的函数值

2. 分片线性插值

   好tm复杂

3. 双线性插值

4. 散乱数据插值法



## Matlab插值

推荐使用函数griddedInterpolant

```matlab
F=griddedInterpolant(x,v,method,extrapolation)
```

method为插值方法（教材p123），extrapolation为外插策略

三次样条插值还可使用函数csape

```matlab
pp=csape(x0,y0,conds,valconds)
```

conds为边界条件，参数在valconds中给出

**plot函数**

```matlab
% plot函数用法:
% plot(x1,y1,x2,y2) 
% 线方式： - 实线 :点线 -. 虚点线 - - 波折线 
% 点方式： . 圆点  +加号  * 星号  x x形  o 小圆
% 颜色： y黄； r红； g绿； b蓝； w白； k黑； m紫； c青
```

教材很全，略



## 拟合

**偏差、残差**：$\delta_i=f(x_i)-y_i,i=1,2,...,n$，采用”偏差的平方和最小“作为判定准则，即使下式达到最小值：
$$
J=\sum_{i=1}^{n}(f(x_i)-y_i)^2
$$
即为**最小二乘原则**，根据此原则确定拟合函数的方法称为**最小二乘法**



### 1.线性最小二乘法

不用奇数次方的原因：误差会正负相抵

不用绝对值的原因：不容易求导，计算复杂

![image-20220713135714812](C:\Users\Hyanice\AppData\Roaming\Typora\typora-user-images\image-20220713135714812.png)



### 2.matlab求解最小二乘法

k，b的取值：

```matlab
k = (n*sum(x.*y)-sum(x)*sum(y))/(n*sum(x.*x)-sum(x)*sum(x))
b = (sum(x.*x)*sum(y)-sum(x)*sum(x.*y))/(n*sum(x.*x)-sum(x)*sum(x))
```



### 3.评价拟合好坏

1. SSE：误差平方和	$SSE=\sum_{i=1}^n(y_i-\widehat y_i)^2$
2. SST：总体平方和    $SST=\sum_{i=1}^n(y_i-\overline y)^2$
3. SSR：回归平方和    $SSR=\sum_{i=1}^n(\widehat y_i-\overline y)^2$

满足：SST=SSE+SSR

**拟合优度$R^2$**：
$$
R^2=\frac{SSR}{SST}=\frac{SST-SSE}{SST}=1-\frac{SSE}{SST}
$$
拟合优度越接近于1，说明拟合效果越好，**仅适用于线性拟合**，非线性拟合可直接参考SSE

```matlab
y_hat = k*x+b; % y的拟合值
SSR = sum((y_hat-mean(y)).^2)  % 回归平方和
SSE = sum((y_hat-y).^2) % 误差平方和
SST = sum((y-mean(y)).^2) % 总体平方和
SST-SSE-SSR   % 5.6843e-14  =   5.6843*10^-14   matlab浮点数计算的一个误差
R_2 = SSR / SST
```

**cftool工具箱**：教材p141

